<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFK Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî¥</text></svg>">
</head>
<body>

<!-- Mobile Sidebar Overlay -->
<div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleMobileMenu()"></div>

<div class="app-layout">

    <!-- LEVEL 1: ICON SIDEBAR (Channels/Orgs) -->
    <aside class="icon-sidebar">
        <a href="#" class="icon-btn logo-btn" title="AFK Live">üî¥</a>

        <div id="channelIconsList" class="channel-list">
            <!-- Populated via JS -->
        </div>

        <button class="icon-btn add-btn" onclick="openConnectModal()" title="Add Channel">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div class="spacer"></div>

        <a href="#" class="icon-btn" onclick="switchView('settings')" title="Settings">
            <img src="" id="userAvatarSmall" class="avatar-small hidden">
            <i class="fa-solid fa-gear" id="settingsIcon"></i>
        </a>
    </aside>

    <!-- LEVEL 2: NAV SIDEBAR (Contextual) -->
    <nav class="sub-sidebar" id="subSidebar">
        <div class="sidebar-header">
            <h2 id="sidebarTitle">Publishing</h2>
            <div class="dropdown-trigger" onclick="toggleChannelDropdown()">
                 <span id="currentChannelName">All Channels</span> <i class="fa-solid fa-chevron-down"></i>
            </div>
            <!-- Dropdown Menu -->
            <div id="channelDropdownMenu" class="dropdown-menu">
                <!-- Populated via JS -->
            </div>
        </div>

        <div class="menu">
            <a href="#" class="menu-item active" data-target="view-publish" onclick="switchView('publish')">
                <i class="fa-regular fa-paper-plane"></i>
                <span>Queue</span>
            </a>
            <a href="#" class="menu-item" data-target="view-calendar" onclick="switchView('calendar')">
                <i class="fa-regular fa-calendar"></i>
                <span>Calendar</span>
            </a>
            <div class="menu-divider"></div>
            <a href="#" class="menu-item" data-target="view-stream" onclick="switchView('stream')">
                <i class="fa-solid fa-satellite-dish"></i>
                <span>Live Stream</span>
            </a>
             <a href="#" class="menu-item" data-target="view-community" onclick="switchView('community')">
                <i class="fa-regular fa-comments"></i>
                <span>Engagement</span>
            </a>
            <a href="#" class="menu-item" data-target="view-analytics" onclick="switchView('analytics')">
                <i class="fa-solid fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="#" class="menu-item" data-target="view-library" onclick="switchView('library')">
                <i class="fa-regular fa-folder"></i>
                <span>Media Library</span>
            </a>
            <div class="menu-divider"></div>
             <a href="#" class="menu-item" data-target="view-settings" onclick="switchView('settings')">
                <i class="fa-solid fa-gear"></i>
                <span>Settings</span>
            </a>
        </div>

        <div class="sidebar-footer">
             <a href="#" class="menu-item" onclick="openSupportModal()">
                <i class="fa-regular fa-life-ring"></i>
                <span>Support</span>
            </a>
             <a href="/logout" class="menu-item logout">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <!-- LEVEL 3: CONTENT -->
    <main class="content-area">

        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="hamburger" onclick="toggleMobileMenu()"><i class="fa-solid fa-bars"></i></button>
            <span class="mobile-title">AFK Live</span>
        </header>

        <div id="verificationBanner" class="hidden warning-banner">
            ‚ö†Ô∏è Please verify your email address to access all features.
        </div>

        <!-- VIEW: PUBLISH -->
        <div id="view-publish" class="view-section">
            <header class="page-header">
                <h1>Queue</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="showScheduleModal()">
                        <i class="fa-solid fa-pen-to-square"></i> Create Post
                    </button>
                </div>
            </header>

            <div class="container-fluid">
                <div class="queue-list" id="queueList">
                     <!-- Populated JS -->
                </div>
            </div>
        </div>

        <!-- VIEW: STREAM -->
        <div id="view-stream" class="view-section hidden">
            <div class="stream-dashboard-layout">
                <!-- LEFT: Preview & Source -->
                <div class="stream-main-panel">
                    <div class="preview-container">
                        <video id="previewPlayer" class="preview-player hidden" controls loop playsinline></video>
                        <div id="previewPlaceholder" class="preview-placeholder">
                            <i class="fa-solid fa-film fa-3x"></i>
                            <span>Select a video to preview</span>
                        </div>
                        <div class="preview-overlay">PREVIEW</div>
                    </div>

                    <div class="card">
                        <div class="card-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                            <h3 style="margin:0">Video Source</h3>
                            <div>
                                <button class="btn btn-outline btn-sm" onclick="openLibraryModalForStream()">Select from Library</button>
                                <button class="btn btn-outline btn-sm" onclick="document.getElementById('streamUploadInput').click()">Upload New</button>
                                <input type="file" id="streamUploadInput" hidden accept="video/*">
                            </div>
                        </div>
                        <div>
                            <div style="display:flex; align-items:center; gap: 10px; margin-bottom: 10px;">
                                <i class="fa-solid fa-file-video" style="color:var(--primary);"></i>
                                <strong id="selectedVideoTitle" style="font-size: 1.1rem;">No video selected</strong>
                            </div>
                            <div style="font-size: 0.9rem; color: #666; display: flex; gap: 20px; align-items: center;">
                                <span><i class="fa-solid fa-rotate"></i> Loop Count:</span>
                                <input type="number" id="streamLoopCount" value="1" min="1" class="form-input" style="width: 80px;">
                                <label style="display:flex; align-items:center; gap:5px; margin:0; font-weight:400; cursor:pointer;">
                                    <input type="checkbox" id="streamLoopInfinite" onchange="document.getElementById('streamLoopCount').disabled = this.checked">
                                    24/7 (Infinite)
                                </label>
                            </div>

                            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                                <div style="font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">Output Resolution (Fixes "Not Supported" errors)</div>
                                <select id="streamOutputMode" class="form-input" style="width: 100%;">
                                    <option value="original">Original (No Change)</option>
                                    <option value="force_landscape">Force 1080p Landscape (16:9)</option>
                                    <option value="force_portrait">Force 1080p Shorts (9:16)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Branding / Watermark -->
                    <div class="card" style="margin-top: 15px;">
                        <div class="card-header">
                            <h3 style="margin:0">Branding</h3>
                        </div>
                        <div class="form-group" style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                            <div>
                                <label style="margin:0">Watermark Overlay</label>
                                <div style="font-size:0.8rem; color:#666;">Adds logo to top-right. <span style="color:red">(Forces Re-encoding)</span></div>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="document.getElementById('streamWatermarkFile').click()">
                                <i class="fa-solid fa-upload"></i> Upload Logo
                            </button>
                            <input type="file" id="streamWatermarkFile" accept=".png,.jpg" hidden onchange="handleWatermarkUpload(this)">
                        </div>
                        <div id="watermarkPreview" class="hidden" style="display:flex; align-items:center; gap:10px; background:#f0f8ff; padding:8px; border-radius:4px;">
                            <img id="watermarkImg" src="" style="height:30px; border-radius:4px;">
                            <div style="flex:1; font-size:0.85rem;" id="watermarkName">logo.png</div>
                            <button class="btn btn-sm btn-text" onclick="clearWatermark()"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    </div>

                    <!-- Music Selection for Live Stream -->
                    <div class="card" style="margin-top: 15px;">
                        <div class="card-header">
                            <h3 style="margin:0">Background Music</h3>
                        </div>
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <button class="btn btn-sm btn-primary" id="tabStreamAudioUpload" onclick="switchStreamAudioTab('upload')">Upload</button>
                            <button class="btn btn-sm btn-outline" id="tabStreamAudioLib" onclick="switchStreamAudioTab('lib')">Stock Library</button>
                        </div>

                        <!-- Upload Tab -->
                        <div id="streamAudioUploadSection">
                            <div class="form-group">
                                <label>Upload MP3</label>
                                <input type="file" id="streamAudioFile" accept=".mp3,.wav" class="form-control" style="font-size:0.9rem;">
                                <input type="hidden" id="uploadedStreamMusicName">
                                <small id="streamAudioUploadStatus" style="color: #666;"></small>
                            </div>
                        </div>

                        <!-- Library Tab -->
                        <div id="streamAudioLibSection" class="hidden">
                            <div id="streamAudioTrackList" class="scroll-list" style="height:150px; border:1px solid #eee; border-radius:4px; margin-bottom:10px;">
                                Loading...
                            </div>
                            <input type="hidden" id="selectedStreamStockId">
                            <div id="selectedStreamTrackName" style="font-size:0.85rem; font-weight:600; color:var(--primary);"></div>
                        </div>

                        <div class="form-group" style="margin-top: 10px;">
                            <label>Music Volume (<span id="streamVolVal">50%</span>)</label>
                            <input type="range" id="streamAudioVol" min="0" max="200" value="50" style="width:100%" oninput="document.getElementById('streamVolVal').innerText = this.value + '%'">
                        </div>

                        <div class="form-group" style="margin-top: 5px;">
                            <label style="display:flex; align-items:center; gap:8px; font-weight:400; cursor:pointer;">
                                <input type="checkbox" id="streamMuteOriginal" checked>
                                <span>Mute original video sound</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Controls -->
                <div class="stream-control-panel">
                    <!-- Status -->
                    <div class="stream-status-box">
                        <div class="status-label">Stream Status</div>
                        <div class="status-timer" id="streamTimer">00:00:00</div>
                        <span class="badge hidden" id="liveBadge">LIVE</span>
                        <span class="badge" id="offlineBadge" style="background:#445; color:#aaa;">OFFLINE</span>
                    </div>

                    <!-- Action -->
                    <div class="control-card">
                         <div style="display:flex; gap:10px; margin-bottom:10px;">
                             <button id="tabGoLiveNow" class="btn btn-sm btn-primary" style="flex:1;" onclick="switchStreamTab('now')">Stream Now</button>
                             <button id="tabScheduleStream" class="btn btn-sm btn-outline" style="flex:1;" onclick="switchStreamTab('schedule')">Schedule</button>
                         </div>

                         <!-- GO LIVE NOW -->
                         <div id="streamActionNow">
                             <button id="btnGoLive" class="btn btn-danger btn-lg btn-block" onclick="submitJob()">
                                <i class="fa-solid fa-tower-broadcast"></i> Go Live
                             </button>
                             <button id="btnStop" class="btn btn-secondary btn-lg btn-block hidden" onclick="stopStream()">End Stream</button>
                         </div>

                         <!-- SCHEDULE STREAM -->
                         <div id="streamActionSchedule" class="hidden">
                             <div class="form-group">
                                 <label>Start Time</label>
                                 <input type="datetime-local" id="streamScheduleTime" class="form-input">
                             </div>
                             <button class="btn btn-primary btn-block" onclick="submitScheduledStream()">
                                <i class="fa-regular fa-clock"></i> Schedule Stream
                             </button>
                             <div style="margin-top:10px; font-size:0.8rem; text-align:center;">
                                 <a href="#" onclick="showScheduledStreamsModal()">View Scheduled Streams</a>
                             </div>
                         </div>
                    </div>

                    <!-- Destinations -->
                    <div class="control-card">
                        <h3>Destinations <button class="btn btn-text btn-sm" onclick="addDestination()"><i class="fa-solid fa-plus"></i></button></h3>
                        <div id="destinationList" class="destination-list">
                            <!-- Populated via JS -->
                            <div class="empty-state" style="padding: 10px; font-size: 0.9rem;">No destinations.</div>
                        </div>
                        <!-- Hidden input to store active key -->
                        <input type="hidden" id="streamKey">
                    </div>

                    <!-- AI Assistant -->
                    <div class="control-card">
                        <h3 style="display:flex; align-items:center; gap:8px;">
                            <i class="fa-solid fa-wand-magic-sparkles" style="color:#8e44ad;"></i> AI Assistant
                        </h3>
                        <div style="display:flex; gap:5px; margin-bottom:10px;">
                            <input type="text" id="aiStreamTopic" class="form-input" placeholder="What are you streaming?" style="flex:1; font-size:0.9rem;">
                            <button class="btn btn-sm btn-outline" onclick="generateStreamMetadata()">Generate</button>
                        </div>
                        <div id="aiMetadataResults" class="hidden">
                            <div class="form-group" style="margin-bottom:8px;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                                    <label style="font-size:0.75rem;">Title</label>
                                    <button class="btn btn-xs btn-text" onclick="copyToClipboard('aiStreamTitle')">Copy</button>
                                </div>
                                <input type="text" id="aiStreamTitle" class="form-input" readonly style="font-size:0.85rem;">
                            </div>
                            <div class="form-group" style="margin-bottom:8px;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                                    <label style="font-size:0.75rem;">Description</label>
                                    <button class="btn btn-xs btn-text" onclick="copyToClipboard('aiStreamDesc')">Copy</button>
                                </div>
                                <textarea id="aiStreamDesc" class="form-input" rows="3" readonly style="font-size:0.85rem;"></textarea>
                            </div>
                            <div class="form-group" style="margin-bottom:8px;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:2px;">
                                    <label style="font-size:0.75rem;">Tags</label>
                                    <button class="btn btn-xs btn-text" onclick="copyToClipboard('aiStreamTags')">Copy</button>
                                </div>
                                <input type="text" id="aiStreamTags" class="form-input" readonly style="font-size:0.85rem;">
                            </div>
                            <div style="background:#f3e5f5; padding:8px; border-radius:4px; border-left:3px solid #8e44ad; font-size:0.8rem; margin-top:10px;">
                                <strong>üí° Engagement Tip:</strong> <span id="aiStreamTip">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Logs -->
                    <div class="control-card" style="flex:1; display:flex; flex-direction:column; min-height: 200px;">
                        <h3>Logs</h3>
                        <div class="terminal-card">
                            <div class="terminal" id="console"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: CALENDAR -->
        <div id="view-calendar" class="view-section hidden">
            <header class="page-header">
                <h1>Calendar</h1>
            </header>
            <div id="calendar" class="calendar-container"></div>
        </div>

        <!-- VIEW: COMMUNITY -->
        <div id="view-community" class="view-section hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                 <h2>Engagement</h2>
                 <div style="display:flex; gap:10px;">
                     <button class="btn btn-outline btn-sm" onclick="loadUnrepliedComments()"><i class="fa-regular fa-envelope-open"></i> Unreplied</button>
                     <button class="btn btn-outline btn-sm" onclick="loadComments()"><i class="fa-solid fa-list"></i> All</button>
                     <button class="btn btn-outline btn-sm" onclick="showEngagementSettings()"><i class="fa-solid fa-robot"></i> AI Automation</button>
                 </div>
            </div>
            <div class="community-layout">
                <div class="thread-list-panel">
                     <div class="search-bar">
                         <input type="text" placeholder="Search comments..." class="form-input">
                     </div>
                     <div id="threadList" class="thread-list"></div>
                </div>
                <div class="thread-view-panel">
                    <div id="emptyThreadState" class="empty-state">
                        <i class="fa-regular fa-comments"></i>
                        <p>Select a conversation</p>
                    </div>
                    <div id="activeThread" class="hidden">
                        <div class="thread-header">
                             <h3 id="threadVideoTitle">Video Title</h3>
                             <a href="#" id="threadVideoLink" target="_blank"><i class="fa-solid fa-external-link"></i></a>
                        </div>
                        <div id="threadMessages" class="thread-messages"></div>

                        <!-- AI Suggestions Area -->
                        <div id="aiSuggestionsArea" class="hidden" style="padding: 10px; background: #f0f8ff; margin-bottom: 10px; border-radius: 4px;">
                            <small style="font-weight:600; color:#0052cc; display:block; margin-bottom:5px;">AI Suggestions:</small>
                            <div id="aiChips" style="display:flex; gap:5px; flex-wrap:wrap;"></div>
                            <button class="btn btn-sm btn-text" onclick="generateSuggestions()" style="font-size:0.8rem; margin-top:5px;"><i class="fa-solid fa-wand-magic-sparkles"></i> Generate</button>
                        </div>

                        <div class="reply-box">
                            <textarea id="replyInput" placeholder="Write a reply..." rows="3"></textarea>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <button class="btn btn-sm btn-outline" onclick="toggleAiSuggestions()"><i class="fa-solid fa-robot"></i> AI Assist</button>
                                <button class="btn btn-primary" onclick="sendReply()">Reply</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: ANALYTICS -->
        <div id="view-analytics" class="view-section hidden">
             <header class="page-header">
                <h1>Analytics</h1>
                <select id="analyticsRange" class="form-select" onchange="initAnalytics()">
                    <option value="7">Last 7 Days</option>
                    <option value="28" selected>Last 28 Days</option>
                    <option value="90">Last 90 Days</option>
                    <option value="365">Last Year</option>
                </select>
            </header>

            <div class="summary-grid">
                 <div class="card summary-card">
                     <h3>Views</h3>
                     <p id="totalViews">0</p>
                 </div>
                 <div class="card summary-card">
                     <h3>Subscribers</h3>
                     <p id="totalSubs">0</p>
                 </div>
                 <div class="card summary-card">
                     <h3>Watch Time</h3>
                     <p id="totalWatchTime">0</p>
                 </div>
             </div>
             <div class="card chart-card">
                 <canvas id="analyticsChart"></canvas>
             </div>
        </div>

        <!-- VIEW: LIBRARY -->
        <div id="view-library" class="view-section hidden">
            <header class="page-header">
                <h1>Media Library</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="document.getElementById('bulkUploadInput').click()">Upload (Video/Zip)</button>
                    <input type="file" id="bulkUploadInput" multiple hidden accept="video/*,.zip">
                    <button class="btn btn-primary" onclick="showAutoScheduleModal()">Auto-Schedule</button>
                </div>
            </header>
            <div id="libraryList" class="queue-list"></div>
        </div>

        <!-- VIEW: SETTINGS -->
        <div id="view-settings" class="view-section hidden" style="padding: 20px;">
            <div class="settings-container">
                <div class="settings-sidebar">
                    <div class="settings-nav-item active" onclick="switchSettingsTab('general')">General</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab('channels')">Channels</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab('benefits')">My Benefits</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab('plans')">Plans & Billing</div>
                </div>
                <div class="settings-content">

                    <!-- TAB: GENERAL -->
                    <div id="tab-general" class="settings-section">
                        <h2>General Settings</h2>
                        <div class="form-group">
                            <label>Connected Accounts</label>
                            <div class="queue-item">
                                <i class="fa-brands fa-google" style="font-size: 1.5rem;"></i>
                                <div style="flex:1">
                                    <div style="font-weight:600">Google Account</div>
                                    <div style="font-size:0.85rem; color:#666" id="settingsGoogleEmail">Connected</div>
                                </div>
                                <a href="/oauth2/authorization/google" class="btn btn-sm btn-outline">Reconnect</a>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: CHANNELS -->
                    <div id="tab-channels" class="settings-section hidden">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                            <h2>Channels</h2>
                            <button class="btn btn-primary btn-sm" onclick="openConnectModal()">+ Add Channel</button>
                        </div>
                        <div id="channelListSettings" class="queue-list"></div>
                    </div>

                    <!-- TAB: BENEFITS -->
                    <div id="tab-benefits" class="settings-section hidden">
                        <h2>My Benefits</h2>
                        <div id="benefitsContent">Loading...</div>
                    </div>

                    <!-- TAB: PLANS -->
                    <div id="tab-plans" class="settings-section hidden">
                        <h2>Subscription</h2>

                        <!-- Usage -->
                        <div class="card" style="margin-bottom: 30px; background: #f9f9f9; border:none;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span>Current Plan: <strong id="planName">Loading...</strong></span>
                                <span id="storageText">0/0</span>
                            </div>
                            <div class="progress-track"><div id="storageBar" class="progress-fill"></div></div>
                            <div style="margin-top: 15px; text-align: right;">
                                <button onclick="cancelSubscription()" class="btn btn-text btn-sm" style="color: var(--danger);">Cancel Subscription</button>
                            </div>
                        </div>

                        <h3>Available Plans</h3>
                        <div id="internalPlanGrid" class="plan-grid">
                            <!-- Loaded via JS -->
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </main>
</div>

<!-- MODALS -->

<!-- Connect Channel Modal -->
<div id="connectChannelModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 450px;">
        <div class="modal-header" style="padding: 0 0 20px 0; border: none;">
            <h2>Connect Channel</h2>
            <button onclick="document.getElementById('connectChannelModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="form-group">
            <label>Select Platform</label>
            <div class="platform-select">
                <div class="platform-option selected" onclick="selectPlatform('YOUTUBE', this)">
                    <i class="fa-brands fa-youtube" style="color: red;"></i> YouTube
                </div>
                <div class="platform-option" onclick="selectPlatform('INSTAGRAM', this)">
                    <i class="fa-brands fa-instagram" style="color: #E1306C;"></i> Instagram
                </div>
                <div class="platform-option" onclick="selectPlatform('SNAPCHAT', this)">
                    <i class="fa-brands fa-snapchat" style="color: #FFFC00; -webkit-text-stroke: 1px black;"></i> Snapchat
                </div>
            </div>
        </div>

        <div id="manualChannelInput" class="hidden">
            <div class="form-group">
                <label>Channel Name / Handle</label>
                <input type="text" id="connectChannelName" class="form-input" placeholder="@handle">
                <small style="color:#666">Enter your handle to link this account.</small>
            </div>
        </div>

        <div class="modal-actions" style="margin-top: 20px; text-align: right;">
            <button class="btn btn-text" onclick="document.getElementById('connectChannelModal').classList.add('hidden')">Cancel</button>
            <button id="btnConnect" class="btn btn-primary" onclick="submitConnectChannel()">Connect</button>
        </div>
    </div>
</div>

<!-- Add Destination Modal -->
<div id="addDestinationModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 400px;">
        <div class="modal-header" style="padding: 0 0 20px 0; border: none;">
            <h2>Add Destination</h2>
            <button onclick="document.getElementById('addDestinationModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="form-group">
            <label>Name</label>
            <input type="text" id="newDestName" class="form-input" placeholder="e.g. YouTube Gaming">
        </div>
        <div class="form-group">
            <label>Stream Key</label>
            <div style="position: relative;">
                <input type="password" id="newDestKey" class="form-input" placeholder="rtmp://..." style="padding-right: 40px;">
                <button type="button" onclick="toggleStreamKeyVisibility('newDestKey', this)" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer;">
                    <i class="fa-solid fa-eye"></i>
                </button>
            </div>
        </div>
        <div class="modal-actions" style="margin-top: 20px; text-align: right;">
            <button class="btn btn-text" onclick="document.getElementById('addDestinationModal').classList.add('hidden')">Cancel</button>
            <button class="btn btn-primary" onclick="submitDestination()">Save Destination</button>
        </div>
    </div>
</div>

<!-- Engagement Settings Modal -->
<div id="engagementSettingsModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 500px;">
        <div class="modal-header" style="border:none;">
            <h2>Engagement Automation</h2>
            <button onclick="document.getElementById('engagementSettingsModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <p style="color:#666; margin-bottom:20px;">Automatically manage comments using AI (Gemini).</p>

        <div class="form-group" style="display:flex; align-items:center; justify-content:space-between; margin-bottom: 20px;">
            <div>
                <label style="margin:0; font-weight:600;">Auto-Like & Reply Positive</label>
                <div style="font-size:0.85rem; color:#888;">Like positive comments and reply with a smiley.</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="engAutoReply">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="form-group" style="display:flex; align-items:center; justify-content:space-between;">
            <div>
                <label style="margin:0; font-weight:600;">Delete Negative Comments</label>
                <div style="font-size:0.85rem; color:#888;">Automatically remove hate speech or negative sentiment.</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="engDeleteNegative">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="modal-actions" style="text-align:right; margin-top:30px;">
            <button class="btn btn-primary" onclick="saveEngagementSettings()">Save Changes</button>
        </div>
    </div>
</div>

<!-- Internal Payment Modal -->
<div id="paymentModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 400px; text-align: center;">
        <h2>Confirm Subscription</h2>
        <p id="paymentPlanName" style="margin: 10px 0; font-size: 1.1rem; color: var(--primary);">Upgrade Plan</p>
        <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: left;">
            <div style="display:flex; justify-content:space-between; margin-bottom: 10px;">
                <span>Total due today:</span>
                <strong id="paymentAmount">$0.00</strong>
            </div>
            <div style="font-size: 0.9rem; color: #666;">
                <i class="fa-solid fa-credit-card"></i> **** **** **** 4242
            </div>
        </div>
        <button id="btnConfirmPayment" class="btn btn-primary btn-block btn-lg" onclick="processPayment()">Pay & Upgrade</button>
        <button class="btn btn-text" onclick="document.getElementById('paymentModal').classList.add('hidden')" style="margin-top: 10px;">Cancel</button>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 350px; text-align: center;">
        <i class="fa-solid fa-circle-exclamation" style="font-size: 3rem; color: #ffab00; margin-bottom: 15px;"></i>
        <h3 id="confirmTitle" style="margin: 0 0 10px 0;">Are you sure?</h3>
        <p id="confirmMessage" style="color: #666; font-size: 0.95rem; margin-bottom: 25px;">This action cannot be undone.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn btn-outline" onclick="closeConfirmModal()">Cancel</button>
            <button id="btnConfirmAction" class="btn btn-danger">Confirm</button>
        </div>
    </div>
</div>

<!-- Support Modal -->
<div id="supportModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 400px;">
        <div class="modal-header" style="border:none;">
            <h2>Contact Support</h2>
            <button onclick="document.getElementById('supportModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <p>Need help? Our team is available 24/7.</p>
        <div style="background: #f4f6f8; padding: 15px; border-radius: 6px; margin: 20px 0;">
            <div style="margin-bottom: 10px;"><i class="fa-solid fa-envelope"></i> <b>Email:</b> support@afklive.com</div>
            <div><i class="fa-solid fa-book"></i> <b>Docs:</b> docs.afklive.com</div>
        </div>
        <button class="btn btn-primary btn-block" onclick="document.getElementById('supportModal').classList.add('hidden')">Close</button>
    </div>
</div>

<!-- Schedule Modal -->
<div id="scheduleModal" class="modal-overlay hidden">
    <div class="modal-composer">
        <div class="modal-header">
            <h2>Create Post</h2>
            <button onclick="closeScheduleModal()" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
            <div class="composer-grid">
                <div class="composer-main">
                    <!-- Step 1: Channel -->
                    <div class="form-group">
                        <label>Post to</label>
                        <div id="modalChannelSelector" class="channel-selector-row"></div>
                    </div>

                    <!-- Step 2: Content -->
                    <div class="form-group">
                        <textarea id="scheduleDescription" class="composer-textarea" placeholder="What would you like to share?"></textarea>
                        <div class="composer-tools">
                             <button class="tool-btn" onclick="aiGenerate('description')" title="AI Assist"><i class="fa-solid fa-wand-magic-sparkles"></i> AI Write</button>
                             <button class="tool-btn" onclick="document.getElementById('scheduleTags').focus()"><i class="fa-solid fa-hashtag"></i> Tags</button>
                        </div>
                    </div>

                    <div class="media-upload-area" id="dropZone">
                        <div id="mediaPlaceholder">
                            <i class="fa-regular fa-image"></i>
                            <span>Add Video</span>
                        </div>
                        <div id="selectedFileDisplay" class="hidden">
                            <i class="fa-solid fa-file-video"></i> <span id="fileName">video.mp4</span>
                        </div>
                        <input type="file" id="scheduleFile" accept="video/*" hidden>
                    </div>

                    <!-- Thumbnail Tools -->
                    <div id="thumbnailTools" class="hidden" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div id="thumbPreview" style="width: 60px; height: 34px; background: #ddd; border-radius: 4px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                                <i class="fa-regular fa-image"></i>
                            </div>
                            <span style="font-size: 0.9rem; font-weight: 500;">Thumbnail</span>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-sm btn-outline" onclick="extractFrame()" title="Extract from Video"><i class="fa-solid fa-camera"></i> Auto</button>
                            <a href="https://www.canva.com/create/youtube-thumbnails/" target="_blank" class="btn btn-sm btn-outline" style="color: #5d26c9; border-color: #5d26c9;"><i class="fa-solid fa-wand-magic-sparkles"></i> Canva</a>
                            <button class="btn btn-sm btn-outline" onclick="document.getElementById('scheduleThumbnail').click()"><i class="fa-solid fa-upload"></i> Upload</button>
                        </div>
                        <input type="file" id="scheduleThumbnail" accept="image/*" hidden>
                    </div>

                    <!-- Hidden Video for Extraction -->
                    <video id="frameExtractorVideo" style="display: none;" crossorigin="anonymous"></video>

                    <!-- Progress -->
                    <div id="uploadProgressContainer" class="hidden">
                        <div class="progress-track"><div id="uploadProgressBar" class="progress-fill"></div></div>
                        <small id="uploadPercent">0%</small>
                    </div>

                    <!-- Details -->
                     <div class="form-row">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="scheduleTitle" class="form-input">
                        </div>
                         <div class="form-group">
                            <label>Time</label>
                            <input type="datetime-local" id="scheduleTime" class="form-input">
                        </div>
                    </div>

                    <div class="collapsible-details">
                         <div class="form-row">
                             <div class="form-group">
                                <label>Category</label>
                                <select id="scheduleCategory" class="form-input"></select>
                             </div>
                             <div class="form-group">
                                <label>Privacy</label>
                                <select id="schedulePrivacy" class="form-input">
                                    <option value="private">Private</option>
                                    <option value="public">Public</option>
                                </select>
                             </div>
                         </div>
                         <div class="form-group">
                             <input type="text" id="scheduleTags" placeholder="Tags (comma separated)" class="form-input">
                         </div>

                         <div class="form-group">
                            <label>First Comment (Pinned)</label>
                            <textarea id="scheduleFirstComment" class="form-input" rows="2" placeholder="Post a comment immediately after upload..."></textarea>
                         </div>

                         <div style="margin-top:15px; padding-top:15px; border-top:1px solid #eee;">
                            <h4 style="margin:0 0 10px 0; font-size:0.95rem;">Audio & Music</h4>

                            <div style="display:flex; gap:10px; margin-bottom:10px;">
                                <button class="btn btn-sm btn-primary" id="tabAudioUpload" onclick="switchAudioTab('upload')">Upload</button>
                                <button class="btn btn-sm btn-outline" id="tabAudioLib" onclick="switchAudioTab('lib')">Stock Library</button>
                            </div>

                            <!-- Upload Tab -->
                            <div id="audioUploadSection">
                                <div class="form-group">
                                    <label>Backing Track (Optional)</label>
                                    <input type="file" id="scheduleAudio" accept=".mp3,.wav" class="form-control" style="font-size:0.9rem;">
                                </div>
                            </div>

                            <!-- Library Tab -->
                            <div id="audioLibSection" class="hidden">
                                <div id="audioTrackList" class="scroll-list" style="height:150px; border:1px solid #eee; border-radius:4px; margin-bottom:10px;">
                                    Loading...
                                </div>
                                <input type="hidden" id="selectedAudioTrackId">
                                <div id="selectedTrackName" style="font-size:0.85rem; font-weight:600; color:var(--primary);"></div>
                            </div>

                            <div class="form-group">
                                <label>Music Volume (<span id="volVal">50%</span>)</label>
                                <input type="range" id="scheduleAudioVol" min="0" max="200" value="50" style="width:100%" oninput="document.getElementById('volVal').innerText = this.value + '%'">
                                <div style="font-size:0.8rem; color:#888;">100% = Original volume. 200% = Boost.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="composer-preview">
                    <div class="preview-card">
                        <div class="preview-card-header">
                            <i class="fa-brands fa-youtube" style="color:red"></i>
                            <span style="font-weight:600; font-size:0.9rem;">YouTube Preview</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; padding: 0 10px 5px;">
                            <span style="font-size:0.8rem; color:#666;">Preview Mode:</span>
                            <div class="toggle-group">
                                <button class="btn btn-xs btn-primary" onclick="setPreviewMode('standard')">16:9</button>
                                <button class="btn btn-xs btn-outline" onclick="setPreviewMode('shorts')">9:16</button>
                            </div>
                        </div>

                        <div class="preview-card-image" id="previewImageMock">
                            <i class="fa-solid fa-play"></i>
                            <!-- Safe Zone Overlay for Shorts -->
                            <div id="shortsSafeZone" class="hidden" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;">
                                <div style="position:absolute; bottom:120px; right:10px; display:flex; flex-direction:column; gap:15px; color:rgba(255,255,255,0.7); align-items:center;">
                                    <i class="fa-solid fa-thumbs-up fa-lg"></i>
                                    <i class="fa-solid fa-comment-dots fa-lg"></i>
                                    <i class="fa-solid fa-share fa-lg"></i>
                                </div>
                                <div style="position:absolute; bottom:20px; left:10px; color:white; font-size:0.8rem;">
                                    <div style="width:30px; height:30px; background:#ccc; border-radius:50%; margin-bottom:5px;"></div>
                                    Channel Name
                                </div>
                            </div>
                        </div>
                        <div class="preview-card-body">
                            <h4 id="previewTitleMock" style="margin:0 0 5px 0; font-size:0.95rem;">Video Title</h4>
                            <div id="previewDescMock" style="font-size:0.85rem; color:#666; line-height:1.4;">
                                Description will appear here...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="btnSchedule" onclick="submitSchedule()">Schedule Post</button>
        </div>
    </div>
</div>

<!-- Auto Schedule Modal -->
<div id="autoScheduleModal" class="modal-overlay hidden">
    <div class="modal-box">
        <h3>Auto Schedule</h3>
        <p>Automatically distribute your library content.</p>
        <div class="form-group">
            <label>Start Date</label>
            <input type="date" id="autoStartDate" class="form-input">
        </div>
        <div class="form-group">
            <label>Times (HH:mm)</label>
            <input type="text" id="autoTimeSlots" placeholder="10:00, 15:00" class="form-input">
        </div>

        <div style="border-top:1px solid #eee; margin: 15px 0; padding-top:15px;">
            <h4 style="margin: 0 0 10px 0;">AI Enhancement</h4>
            <div class="form-group">
                <label>Base Topic (Optional)</label>
                <input type="text" id="autoTopic" placeholder="e.g. Minecraft Gameplay" class="form-input">
            </div>
            <div class="form-group" style="display:flex; align-items:center; gap:10px;">
                <input type="checkbox" id="autoUseAi">
                <label for="autoUseAi" style="margin:0; font-weight:400;">Generate Titles, Descriptions & Tags with AI</label>
            </div>
        </div>

        <div class="modal-actions">
            <button class="btn btn-primary" onclick="submitAutoSchedule()">Apply</button>
            <button class="btn btn-text" onclick="document.getElementById('autoScheduleModal').classList.add('hidden')">Cancel</button>
        </div>
    </div>
</div>

<!-- Stream Library Modal -->
<div id="streamLibraryModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 500px;">
        <div class="modal-header" style="border:none; padding-bottom: 10px;">
            <h2>Select Video</h2>
            <button onclick="document.getElementById('streamLibraryModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="streamLibraryList" class="scroll-list" style="height: 300px; padding: 0;"></div>
    </div>
</div>

<!-- Scheduled Streams List Modal -->
<div id="scheduledStreamsModal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 600px;">
        <div class="modal-header" style="border:none; padding-bottom: 10px;">
            <h2>Scheduled Streams</h2>
            <button onclick="document.getElementById('scheduledStreamsModal').classList.add('hidden')" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="scheduledStreamsList" class="scroll-list" style="max-height: 400px; overflow-y:auto; padding: 0;">
            Loading...
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="js/toast.js"></script>
<script src="js/app.js"></script>
</body>
</html>
